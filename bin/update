#! /usr/bin/env bash
#
# update <destination> <Bro args>

. `dirname $0`/broctl-config.sh

node=$1
shift
args=$@

# Creating temporary working directory.
dir=${tmpdir}/update-$1-$$
rm -rf $dir
mkdir $dir
cd $dir

export PATH=${bindir}:${scriptsdir}:$PATH

policies=${policydir}
export BROPATH=${policydirsiteinstallauto}:${policydirsiteinstall}:$policies:$policies/broctl

${bro} $args support/remote/config "Remote::config_node=$node" >out.log 2>&1
rc=$?

cat out.log | egrep -v "warning: no such host|received termination signal"
rm -rf $dir

exit $rc

