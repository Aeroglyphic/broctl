#! /usr/bin/env bash
#
# update <destination> <Bro args>

. `dirname $0`/broctl-config.sh

host=$1
shift
port=$1
shift
args=$@

# Creating temporary working directory.
dir=${tmpdir}/update-$1-$$
rm -rf $dir
mkdir $dir
cd $dir

export PATH=${bindir}:${scriptsdir}:$PATH
export BROPATH=${policydirsiteinstallauto}:${policydirsiteinstall}:${policydir}

${bro} $args frameworks/control/controller "Control::host=$host" "Control::host_port=$port" "Control::cmd=configuration_update" >out.log 2>&1
rc=$?

cat out.log | egrep -v "warning: no such host|received termination signal"
rm -rf $dir

exit $rc

