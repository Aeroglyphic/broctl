#! /usr/bin/env bash
#
#  start [ -v var=value [ -v ...]] <cwd> <pin_cpu> <Bro args>

. `dirname $0`/../broctl-config.sh

while getopts 'v:' flag; do
    case "${flag}" in
        v) eval export "${OPTARG}" ;;
    esac
done

shift $((OPTIND-1))

cd $1 2>/dev/null
shift

rm -f .pid

if [ ! -x ${scriptsdir}/run-bro ]; then
    exit 1
fi

nohup ${scriptsdir}/run-bro "$@" >stdout.log 2>stderr.log &

while [ ! -s .pid ]; do
   sleep 1
done

ret=0
pid=`cat .pid`
[ "$pid" = "-1" ] && ret=1

echo $pid
exit $ret

